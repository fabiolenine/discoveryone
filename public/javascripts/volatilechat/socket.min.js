var userNames=function(){var e={},t=function(t){return!t||e[t]?!1:(e[t]=!0,!0)},r=function(){var e,r=1;do e="Guest "+r,r+=1;while(!t(e));return e},n=function(){var t=[];for(user in e)t.push(user);return t},i=function(t){e[t]&&delete e[t]};return{claim:t,free:i,get:n,getGuestName:r}}();module.exports=function(e){var t=userNames.getGuestName();e.emit("init",{name:t,users:userNames.get()}),e.broadcast.emit("user:join",{name:t}),e.on("send:message",function(r){e.broadcast.emit("send:message",{user:t,text:r.message})}),e.on("change:name",function(r,n){if(userNames.claim(r.name)){var i=t;userNames.free(i),t=r.name,e.broadcast.emit("change:name",{oldName:i,newName:t}),n(!0)}else n(!1)}),e.on("disconnect",function(){e.broadcast.emit("user:left",{name:t}),userNames.free(t)})};